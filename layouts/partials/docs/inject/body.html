<!-- Make card-style containers fully clickable -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Homepage cards: each .flex-even has an h3 > a with the destination
    document.querySelectorAll('.book-columns > .flex-even').forEach(function(card) {
      var link = card.querySelector('h3 a[href]:not(.anchor)');
      if (!link) return;
      card.addEventListener('click', function(e) {
        // Don't interfere if user clicked an actual link inside the card
        if (e.target.closest('a')) return;
        link.click();
      });
    });
    // Blog entry cards: each .blog-entry has an h2 > a with the destination
    document.querySelectorAll('.blog-entry').forEach(function(card) {
      var link = card.querySelector('h2 a[href]');
      if (!link) return;
      card.addEventListener('click', function(e) {
        if (e.target.closest('a')) return;
        link.click();
      });
    });
  });
</script>
{{ with .Site.Params.goatCounterCode }}
<!-- GoatCounter Analytics -->
<script>
    // Disable GoatCounter on PR preview deployments.
    if (window.location.pathname.startsWith('/pr-preview/'))
        window.goatcounter = {no_onload: true}
</script>
<script data-goatcounter="https://{{ . }}.goatcounter.com/count"
        async src="//gc.zgo.at/count.js"></script>
<script>
  // SPA navigation tracking
  (function() {
    var defined = function(v) { return typeof v !== 'undefined'; };

    // Track page views on hash changes (for SPA-like navigation)
    window.addEventListener('hashchange', function() {
      if (defined(window.goatcounter) && defined(window.goatcounter.count)) {
        window.goatcounter.count({
          path: location.pathname + location.search + location.hash
        });
      }
    });

    // Track page views on popstate (browser back/forward)
    window.addEventListener('popstate', function() {
      if (defined(window.goatcounter) && defined(window.goatcounter.count)) {
        window.goatcounter.count({
          path: location.pathname + location.search + location.hash
        });
      }
    });

    // Expose search tracking function for Pagefind integration
    window.trackSearch = function(query) {
      if (defined(window.goatcounter) && defined(window.goatcounter.count) && query && query.trim()) {
        window.goatcounter.count({
          path: 'search',
          title: 'Search: ' + query.trim(),
          event: true
        });
      }
    };
  })();
</script>
{{ end }}
